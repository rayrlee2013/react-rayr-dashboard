/**
 * Created by Rayr Lee on 2019/6/19.
 */

import React from 'react';
import _ from 'loadsh';

var dataObj = {
    '110000': {
        '2000': '1364',
        '2001': '1385',
        '2002': '1423',
        '2003': '1456',
        '2004': '1493',
        '2005': '1538',
        '2006': '1601',
        '2007': '1676',
        '2008': '1771',
        '2009': '1860',
        '2010': '1962',
        '2011': '2019',
        '2012': '2069',
        '2013': '2115',
        '2014': '2152',
        '2015': '2171',
        '2016': '2173',
        '2017': '2171',
        '2018': null
    },
    '120000': {
        '2000': '1001',
        '2001': '1004',
        '2002': '1007',
        '2003': '1011',
        '2004': '1024',
        '2005': '1043',
        '2006': '1075',
        '2007': '1115',
        '2008': '1176',
        '2009': '1228',
        '2010': '1299',
        '2011': '1355',
        '2012': '1413',
        '2013': '1472',
        '2014': '1517',
        '2015': '1547',
        '2016': '1562',
        '2017': '1557',
        '2018': null
    },
    '130000': {
        '2000': '6674',
        '2001': '6699',
        '2002': '6735',
        '2003': '6769',
        '2004': '6809',
        '2005': '6851',
        '2006': '6898',
        '2007': '6943',
        '2008': '6989',
        '2009': '7034',
        '2010': '7194',
        '2011': '7241',
        '2012': '7288',
        '2013': '7333',
        '2014': '7384',
        '2015': '7425',
        '2016': '7470',
        '2017': '7520',
        '2018': null
    },
    '140000': {
        '2000': '3247',
        '2001': '3272',
        '2002': '3294',
        '2003': '3314',
        '2004': '3335',
        '2005': '3355',
        '2006': '3375',
        '2007': '3393',
        '2008': '3411',
        '2009': '3427',
        '2010': '3574',
        '2011': '3593',
        '2012': '3611',
        '2013': '3630',
        '2014': '3648',
        '2015': '3664',
        '2016': '3682',
        '2017': '3702',
        '2018': null
    },
    '150000': {
        '2000': '2372',
        '2001': '2381',
        '2002': '2384',
        '2003': '2386',
        '2004': '2393',
        '2005': '2403',
        '2006': '2415',
        '2007': '2429',
        '2008': '2444',
        '2009': '2458',
        '2010': '2472',
        '2011': '2482',
        '2012': '2490',
        '2013': '2498',
        '2014': '2505',
        '2015': '2511',
        '2016': '2520',
        '2017': '2529',
        '2018': null
    },
    '210000': {
        '2000': '4184',
        '2001': '4194',
        '2002': '4203',
        '2003': '4210',
        '2004': '4217',
        '2005': '4221',
        '2006': '4271',
        '2007': '4298',
        '2008': '4315',
        '2009': '4341',
        '2010': '4375',
        '2011': '4383',
        '2012': '4389',
        '2013': '4390',
        '2014': '4391',
        '2015': '4382',
        '2016': '4378',
        '2017': '4369',
        '2018': null
    },
    '220000': {
        '2000': '2682',
        '2001': '2691',
        '2002': '2699',
        '2003': '2704',
        '2004': '2709',
        '2005': '2716',
        '2006': '2723',
        '2007': '2730',
        '2008': '2734',
        '2009': '2740',
        '2010': '2747',
        '2011': '2749',
        '2012': '2750',
        '2013': '2751',
        '2014': '2752',
        '2015': '2753',
        '2016': '2733',
        '2017': '2717',
        '2018': null
    },
    '230000': {
        '2000': '3807',
        '2001': '3811',
        '2002': '3813',
        '2003': '3815',
        '2004': '3817',
        '2005': '3820',
        '2006': '3823',
        '2007': '3824',
        '2008': '3825',
        '2009': '3826',
        '2010': '3833',
        '2011': '3834',
        '2012': '3834',
        '2013': '3835',
        '2014': '3833',
        '2015': '3812',
        '2016': '3799',
        '2017': '3789',
        '2018': null
    },
    '310000': {
        '2000': '1609',
        '2001': '1668',
        '2002': '1713',
        '2003': '1766',
        '2004': '1835',
        '2005': '1890',
        '2006': '1964',
        '2007': '2064',
        '2008': '2141',
        '2009': '2210',
        '2010': '2303',
        '2011': '2347',
        '2012': '2380',
        '2013': '2415',
        '2014': '2426',
        '2015': '2415',
        '2016': '2420',
        '2017': '2418',
        '2018': null
    },
    '320000': {
        '2000': '7327',
        '2001': '7359',
        '2002': '7406',
        '2003': '7458',
        '2004': '7523',
        '2005': '7588',
        '2006': '7656',
        '2007': '7723',
        '2008': '7762',
        '2009': '7810',
        '2010': '7869',
        '2011': '7899',
        '2012': '7920',
        '2013': '7939',
        '2014': '7960',
        '2015': '7976',
        '2016': '7999',
        '2017': '8029',
        '2018': null
    },
    '330000': {
        '2000': '4680',
        '2001': '4729',
        '2002': '4776',
        '2003': '4857',
        '2004': '4925',
        '2005': '4991',
        '2006': '5072',
        '2007': '5155',
        '2008': '5212',
        '2009': '5276',
        '2010': '5447',
        '2011': '5463',
        '2012': '5477',
        '2013': '5498',
        '2014': '5508',
        '2015': '5539',
        '2016': '5590',
        '2017': '5657',
        '2018': null
    },
    '340000': {
        '2000': '6093',
        '2001': '6128',
        '2002': '6144',
        '2003': '6163',
        '2004': '6228',
        '2005': '6120',
        '2006': '6110',
        '2007': '6118',
        '2008': '6135',
        '2009': '6131',
        '2010': '5957',
        '2011': '5968',
        '2012': '5988',
        '2013': '6030',
        '2014': '6083',
        '2015': '6144',
        '2016': '6196',
        '2017': '6255',
        '2018': null
    },
    '350000': {
        '2000': '3410',
        '2001': '3445',
        '2002': '3476',
        '2003': '3502',
        '2004': '3529',
        '2005': '3557',
        '2006': '3585',
        '2007': '3612',
        '2008': '3639',
        '2009': '3666',
        '2010': '3693',
        '2011': '3720',
        '2012': '3748',
        '2013': '3774',
        '2014': '3806',
        '2015': '3839',
        '2016': '3874',
        '2017': '3911',
        '2018': null
    },
    '360000': {
        '2000': '4149',
        '2001': '4186',
        '2002': '4222',
        '2003': '4254',
        '2004': '4284',
        '2005': '4311',
        '2006': '4339',
        '2007': '4368',
        '2008': '4400',
        '2009': '4432',
        '2010': '4462',
        '2011': '4488',
        '2012': '4504',
        '2013': '4522',
        '2014': '4542',
        '2015': '4566',
        '2016': '4592',
        '2017': '4622',
        '2018': null
    },
    '370000': {
        '2000': '8998',
        '2001': '9041',
        '2002': '9082',
        '2003': '9125',
        '2004': '9180',
        '2005': '9248',
        '2006': '9309',
        '2007': '9367',
        '2008': '9417',
        '2009': '9470',
        '2010': '9588',
        '2011': '9637',
        '2012': '9685',
        '2013': '9733',
        '2014': '9789',
        '2015': '9847',
        '2016': '9947',
        '2017': '10006',
        '2018': null
    },
    '410000': {
        '2000': '9488',
        '2001': '9555',
        '2002': '9613',
        '2003': '9667',
        '2004': '9717',
        '2005': '9380',
        '2006': '9392',
        '2007': '9360',
        '2008': '9429',
        '2009': '9487',
        '2010': '9405',
        '2011': '9388',
        '2012': '9406',
        '2013': '9413',
        '2014': '9436',
        '2015': '9480',
        '2016': '9532',
        '2017': '9559',
        '2018': null
    },
    '420000': {
        '2000': '5646',
        '2001': '5658',
        '2002': '5672',
        '2003': '5685',
        '2004': '5698',
        '2005': '5710',
        '2006': '5693',
        '2007': '5699',
        '2008': '5711',
        '2009': '5720',
        '2010': '5728',
        '2011': '5758',
        '2012': '5779',
        '2013': '5799',
        '2014': '5816',
        '2015': '5852',
        '2016': '5885',
        '2017': '5902',
        '2018': null
    },
    '430000': {
        '2000': '6562',
        '2001': '6596',
        '2002': '6629',
        '2003': '6663',
        '2004': '6698',
        '2005': '6326',
        '2006': '6342',
        '2007': '6355',
        '2008': '6380',
        '2009': '6406',
        '2010': '6570',
        '2011': '6596',
        '2012': '6639',
        '2013': '6691',
        '2014': '6737',
        '2015': '6783',
        '2016': '6822',
        '2017': '6860',
        '2018': null
    },
    '440000': {
        '2000': '8650',
        '2001': '8733',
        '2002': '8842',
        '2003': '8963',
        '2004': '9111',
        '2005': '9194',
        '2006': '9442',
        '2007': '9660',
        '2008': '9893',
        '2009': '10130',
        '2010': '10441',
        '2011': '10505',
        '2012': '10594',
        '2013': '10644',
        '2014': '10724',
        '2015': '10849',
        '2016': '10999',
        '2017': '11169',
        '2018': null
    },
    '450000': {
        '2000': '4751',
        '2001': '4788',
        '2002': '4822',
        '2003': '4857',
        '2004': '4889',
        '2005': '4660',
        '2006': '4719',
        '2007': '4768',
        '2008': '4816',
        '2009': '4856',
        '2010': '4610',
        '2011': '4645',
        '2012': '4682',
        '2013': '4719',
        '2014': '4754',
        '2015': '4796',
        '2016': '4838',
        '2017': '4885',
        '2018': null
    },
    '460000': {
        '2000': '789',
        '2001': '796',
        '2002': '803',
        '2003': '811',
        '2004': '818',
        '2005': '828',
        '2006': '836',
        '2007': '845',
        '2008': '854',
        '2009': '864',
        '2010': '869',
        '2011': '877',
        '2012': '887',
        '2013': '895',
        '2014': '903',
        '2015': '911',
        '2016': '917',
        '2017': '926',
        '2018': null
    },
    '500000': {
        '2000': '2849',
        '2001': '2829',
        '2002': '2814',
        '2003': '2803',
        '2004': '2793',
        '2005': '2798',
        '2006': '2808',
        '2007': '2816',
        '2008': '2839',
        '2009': '2859',
        '2010': '2885',
        '2011': '2919',
        '2012': '2945',
        '2013': '2970',
        '2014': '2991',
        '2015': '3017',
        '2016': '3048',
        '2017': '3075',
        '2018': null
    },
    '510000': {
        '2000': '8329',
        '2001': '8143',
        '2002': '8110',
        '2003': '8176',
        '2004': '8090',
        '2005': '8212',
        '2006': '8169',
        '2007': '8127',
        '2008': '8138',
        '2009': '8185',
        '2010': '8045',
        '2011': '8050',
        '2012': '8076',
        '2013': '8107',
        '2014': '8140',
        '2015': '8204',
        '2016': '8262',
        '2017': '8302',
        '2018': null
    },
    '520000': {
        '2000': '3756',
        '2001': '3799',
        '2002': '3837',
        '2003': '3870',
        '2004': '3904',
        '2005': '3730',
        '2006': '3690',
        '2007': '3632',
        '2008': '3596',
        '2009': '3537',
        '2010': '3479',
        '2011': '3469',
        '2012': '3484',
        '2013': '3502',
        '2014': '3508',
        '2015': '3530',
        '2016': '3555',
        '2017': '3580',
        '2018': null
    },
    '530000': {
        '2000': '4241',
        '2001': '4287',
        '2002': '4333',
        '2003': '4376',
        '2004': '4415',
        '2005': '4450',
        '2006': '4483',
        '2007': '4514',
        '2008': '4543',
        '2009': '4571',
        '2010': '4602',
        '2011': '4631',
        '2012': '4659',
        '2013': '4687',
        '2014': '4714',
        '2015': '4742',
        '2016': '4771',
        '2017': '4801',
        '2018': null
    },
    '540000': {
        '2000': '258',
        '2001': '264',
        '2002': '268',
        '2003': '272',
        '2004': '276',
        '2005': '280',
        '2006': '285',
        '2007': '289',
        '2008': '292',
        '2009': '296',
        '2010': '300',
        '2011': '303',
        '2012': '308',
        '2013': '312',
        '2014': '318',
        '2015': '324',
        '2016': '331',
        '2017': '337',
        '2018': null
    },
    '610000': {
        '2000': '3644',
        '2001': '3653',
        '2002': '3662',
        '2003': '3672',
        '2004': '3681',
        '2005': '3690',
        '2006': '3699',
        '2007': '3708',
        '2008': '3718',
        '2009': '3727',
        '2010': '3735',
        '2011': '3743',
        '2012': '3753',
        '2013': '3764',
        '2014': '3775',
        '2015': '3793',
        '2016': '3813',
        '2017': '3835',
        '2018': null
    },
    '620000': {
        '2000': '2515',
        '2001': '2523',
        '2002': '2531',
        '2003': '2537',
        '2004': '2541',
        '2005': '2545',
        '2006': '2547',
        '2007': '2548',
        '2008': '2551',
        '2009': '2555',
        '2010': '2560',
        '2011': '2564',
        '2012': '2578',
        '2013': '2582',
        '2014': '2591',
        '2015': '2600',
        '2016': '2610',
        '2017': '2626',
        '2018': null
    },
    '630000': {
        '2000': '517',
        '2001': '523',
        '2002': '529',
        '2003': '534',
        '2004': '539',
        '2005': '543',
        '2006': '548',
        '2007': '552',
        '2008': '554',
        '2009': '557',
        '2010': '563',
        '2011': '568',
        '2012': '573',
        '2013': '578',
        '2014': '583',
        '2015': '588',
        '2016': '593',
        '2017': '598',
        '2018': null
    },
    '640000': {
        '2000': '554',
        '2001': '563',
        '2002': '572',
        '2003': '580',
        '2004': '588',
        '2005': '596',
        '2006': '604',
        '2007': '610',
        '2008': '618',
        '2009': '625',
        '2010': '633',
        '2011': '639',
        '2012': '647',
        '2013': '654',
        '2014': '662',
        '2015': '668',
        '2016': '675',
        '2017': '682',
        '2018': null
    },
    '650000': {
        '2000': '1849',
        '2001': '1876',
        '2002': '1905',
        '2003': '1934',
        '2004': '1963',
        '2005': '2010',
        '2006': '2050',
        '2007': '2095',
        '2008': '2131',
        '2009': '2159',
        '2010': '2185',
        '2011': '2209',
        '2012': '2233',
        '2013': '2264',
        '2014': '2298',
        '2015': '2360',
        '2016': '2398',
        '2017': '2445',
        '2018': null
    },
    '710000': {
        '2000': '2228',
        '2001': '2240',
        '2002': '2252',
        '2003': '2260',
        '2004': '2270',
        '2005': '2277',
        '2006': '2288',
        '2007': '2296',
        '2008': '2304',
        '2009': '2312',
        '2010': '2316',
        '2011': '2322',
        '2012': '2332',
        '2013': '2337',
        '2014': '2343',
        '2015': '2349',
        '2016': '2354',
        '2017': '2357',
        '2018': '2359'
    },
    '810000': {
        '2000': '667',
        '2001': '671',
        '2002': '674',
        '2003': '673',
        '2004': '678',
        '2005': '681',
        '2006': '686',
        '2007': '692',
        '2008': '696',
        '2009': '697',
        '2010': '702',
        '2011': '707',
        '2012': '715',
        '2013': '718',
        '2014': '723',
        '2015': '729',
        '2016': '734',
        '2017': '739',
        '2018': null
    },
    '820000': {
        '2000': '43',
        '2001': '44',
        '2002': '45',
        '2003': '46',
        '2004': '47',
        '2005': '48',
        '2006': '49',
        '2007': '50',
        '2008': '51',
        '2009': '52',
        '2010': '54',
        '2011': '55',
        '2012': '56',
        '2013': '58',
        '2014': '59',
        '2015': '60',
        '2016': '60',
        '2017': '62',
        '2018': null
    },
    '100000': {
        '2000': '0',
        '2001': '0',
        '2002': '0',
        '2003': '0',
        '2004': '0',
        '2005': '0',
        '2006': '0',
        '2007': '0',
        '2008': '0',
        '2009': '0',
        '2010': '0',
        '2011': '0',
        '2012': '0',
        '2013': '0',
        '2014': '0',
        '2015': '0',
        '2016': '0',
        '2017': '0',
        '2018': '0'
    }
}

var areaData = { //万平方公里
    '110000': 1.6807,
    '120000': 1.13,
    '130000': 19,
    '140000': 15.6,
    '150000': 118.3,
    '210000': 14.57,
    '220000': 18.74,
    '230000': 47.3,
    '310000': 0.634,
    '320000': 10.26,
    '330000': 10.18,
    '340000': 13.96,
    '350000': 12.14,
    '360000': 16.69,
    '370000': 15.7,
    '410000': 16.7,
    '420000': 18.59,
    '430000': 21.18,
    '440000': 17.98,
    '450000': 23.63,
    '460000': 3.392,
    '500000': 8.3,
    '510000': 48.5,
    '520000': 17.62,
    '530000': 39.4,
    '540000': 122.84,
    '610000': 20.58,
    '620000': 45.5,
    '630000': 72,
    '640000': 6.64,
    '650000': 166.49,
    '710000': 3.62,
    '810000': 0.1098,
    '820000': 0.0254
}

export default class extends React.Component {

    chart = null;

    resize() {
        this.chart.resize();
    }

    componentDidMount() {
        let option = _.merge(this.props.option, defaultOption);
        console.log(option);
        this.chart = echarts.init(this.refs.echart, 'light');
        this.chart.setOption(option);
        window.addEventListener('resize', this.resize.bind(this), false);
    }

    componentWillUnmount() {
        this.chart.dispose();
        this.chart = null;
        window.removeEventListener('resize', this.resize.bind(this), false);
    }

    render() {
        return (
            <div ref="echart" style={{minHeight: 420}}></div>
        )
    }
}


var w = document.body.clientWidth;
var h = 750;

var proj = d3.geoMercator();
var path = d3.geoPath().projection(proj);

var color = d3.scaleQuantize()
    .domain([1, 2000])
    .range(d3.schemeBlues[9]);

var map = d3.select('#vis')
    .append('svg')
    .attr('width', w)
    .attr('height', h);

//console.log(color.domain());

proj.center([107, 41]) //set up center coordinate of map
proj.translate([w / 2, h / 2 - 80]); // the projection's default translation
proj.scale(750); // the projection's default scale

var china = map.append('svg').attr('id', 'china');

d3.json('china.json').then(data => {
    china.selectAll('path')
        .data(data.features)
        .enter()
        .append('path')
        .transition()
        .attr('d', path)
        .attr('fill', function (d) {
            var n = Number(dataObj[d.properties.adcode][2017]);
            var c = Number((n / areaData[d.properties.adcode]).toFixed(0));
            //console.log(c);
            return color(c);
        })
        .attr('stroke', 'white')
        .attr('stroke-linejoin', 'round');

    const x = d3.scaleLinear()
        .domain(d3.extent(color.domain()))
        .rangeRound([0, 260]);

    china.selectAll('rect')
        .data(color.range().map(d => color.invertExtent(d)))
        .join('rect')
        .attr('height', 8)
        .attr('x', d => {
            console.log(x(d[0]), d);
            return x(d[0]);
        })
        .attr('width', d => x(d[1]) - x(d[0]))
        .attr('fill', d => color(d[0]));

    china.append("text")
        .attr("x", x.range()[0])
        .attr("y", 40)
        .attr("fill", "currentColor")
        .attr("text-anchor", "start")
        .text('比例尺');
});
